class VariantQuickViewSelects extends HTMLElement{constructor(){super(),this.item=this.closest(".quickView"),this.variants=this.getVariantData(),this.onVariantInit=debounce(()=>{var t;this.updateOptions(),this.updateMasterId(),this.updateMedia(500),this.updateVariants(this.variants),this.checkNeedToConvertCurrency()&&(t=document.getElementById("currencies")?.querySelector(".active")?.getAttribute("data-currency"),Currency.convertAll(window.shop_currency,t,"span.money","money_format"))},500),this.onVariantInit(),this.addEventListener("change",this.onVariantChange.bind(this))}onVariantChange(t){this.updateOptions(),this.updateMasterId(),this.updateVariants(this.variants),this.currentVariant?(this.updateMedia(200),this.updateProductInfo(),this.updateAttribute(!1,!this.currentVariant.available),this.checkQuantityWhenVariantChange()):this.updateAttribute(!0)}updateVariants(r){const t=Array.from(this.querySelectorAll(".product-form__input"));var i,o,n,e=document.getElementById("product-quick-view-option-"+this.dataset.product)?.getAttribute("data-type");let s,u,c;r&&(n="button"==e?(t[0]&&(s=Array.from(t[0].querySelectorAll("input")).find(t=>t.checked).value,t[0].querySelector("[data-header-option]").textContent=s),t[1]&&(u=Array.from(t[1].querySelectorAll("input")).find(t=>t.checked).value,t[1].querySelector("[data-header-option]").textContent=u),t[2]&&(c=Array.from(t[2].querySelectorAll("input")).find(t=>t.checked).value,t[2].querySelector("[data-header-option]").textContent=c),i=()=>{var a,e=parseInt(t.length);1<e&&(a=r.filter(t=>{switch(e){case 2:return t.option2===u;case 3:return t.option3===c}}),t[0].querySelectorAll(".product-form__radio").forEach(e=>{var t=e.nextSibling,i=Array.from(a).find(t=>t.option1==e.value&&t.available),n=Array.from(a).find(t=>t.option1==e.value);null==i?null==n?(t.classList.remove("available"),t.classList.remove("soldout"),t.classList.add("unavailable")):(t.classList.remove("available"),t.classList.remove("unavailable"),t.classList.add("soldout")):(t.classList.remove("soldout"),t.classList.remove("unavailable"),t.classList.add("available"))}))},o=(t,e,i,n)=>{i=i.nextSibling;null==t?null==e?(i.classList.remove("available"),i.classList.remove("soldout"),i.classList.add("unavailable")):(i.classList.remove("available"),i.classList.remove("unavailable"),i.classList.add("soldout")):(i.classList.remove("soldout"),i.classList.remove("unavailable"),i.classList.add("available"))},(a,t)=>{t.querySelectorAll(".product-form__radio").forEach(t=>{const e=t.value;var i=r.find(t=>{switch(a){case 0:return t.option1==e&&t.available;case 1:return t.option1==s&&t.option2==e&&t.available;case 2:return t.option1==s&&t.option2==u&&t.option3==e&&t.available}}),n=r.find(t=>{switch(a){case 0:return t.option1==e;case 1:return t.option1==s&&t.option2==e;case 2:return t.option1==s&&t.option2==u&&t.option3==e}});o(i,n,t,a)})}):(t[0]&&(s=t[0].querySelector("select").value,t[0].querySelector("[data-header-option]").textContent=s),t[1]&&(u=t[1].querySelector("select").value,t[1].querySelector("[data-header-option]").textContent=u),t[2]&&(c=t[2].querySelector("select").value,t[2].querySelector("[data-header-option]").textContent=c),i=()=>{var n,e=parseInt(t.length);1<e&&(n=r.filter(t=>{switch(e){case 2:return t.option2===u;case 3:return t.option3===c}}),t[0].querySelectorAll("option").forEach(e=>{var t=Array.from(n).find(t=>t.option1==e.value&&t.available),i=Array.from(n).find(t=>t.option1==e.value);null==t?null==i?(e.classList.remove("available"),e.classList.remove("soldout"),e.classList.add("unavailable"),e.setAttribute("disabled","disabled")):(e.classList.remove("available"),e.classList.remove("unavailable"),e.classList.add("soldout"),e.removeAttribute("disabled")):(e.classList.remove("soldout"),e.classList.remove("unavailable"),e.classList.add("available"),e.removeAttribute("disabled"))}))},o=(t,e,i)=>{null==t?null==e?(i.classList.remove("available"),i.classList.remove("soldout"),i.classList.add("unavailable"),i.setAttribute("disabled","disabled")):(i.classList.remove("available"),i.classList.remove("unavailable"),i.classList.add("soldout"),i.removeAttribute("disabled")):(i.classList.remove("soldout"),i.classList.remove("unavailable"),i.classList.add("available"),i.removeAttribute("disabled"))},(a,t)=>{t.querySelectorAll("option").forEach(t=>{const e=t.getAttribute("value");var i=r.find(t=>{switch(a){case 0:return t.option1==e&&t.available;case 1:return t.option1==s&&t.option2==e&&t.available;case 2:return t.option1==s&&t.option2==u&&t.option3==e&&t.available}}),n=r.find(t=>{switch(a){case 0:return t.option1==e;case 1:return t.option1==s&&t.option2==e;case 2:return t.option1==s&&t.option2==u&&t.option3==e}});o(i,n,t)})}),t.forEach(t=>{var e=parseInt(t.getAttribute("data-option-index"));n(e,t),i()}))}updateOptions(){this.options=Array.from(this.querySelectorAll("select"),t=>t.value)}updateMasterId(){this.currentVariant=this.getVariantData().find(t=>!t.options.map((t,e)=>this.options[e]===t).includes(!1))}updateMedia(t){if(this.currentVariant&&this.currentVariant?.featured_media){const e=document.querySelector(`[data-media-id="${this.dataset.product}-${this.currentVariant.featured_media.id}"]`);e&&window.setTimeout(()=>{$(e).trigger("click")},t)}}updateProductInfo(){(async()=>{try{var t,e=await(await fetch(`${this.dataset.url}?variant=${this.currentVariant.id}&view=ajax_product_price`)).text(),i=(new DOMParser).parseFromString(e,"text/html"),n=document.getElementById("product-quick-view-price-"+this.dataset.product),a=i.querySelector("body");a&&n&&(n.innerHTML=a.innerHTML),this.checkNeedToConvertCurrency()&&(t=document.getElementById("currencies")?.querySelector(".active")?.getAttribute("data-currency"),Currency.convertAll(window.shop_currency,t,"span.money","money_format")),n?.classList.remove("visibility-hidden")}catch(t){console.log("Something went wrong to fetch data!")}})()}updateAttribute(o=!0,s=!0){this.quantityInput=this.item.querySelector('input[name="quantity"]'),this.inventoryProp=this.item.querySelector("[data-inventory]"),this.skuProp=this.item.querySelector("[data-sku]"),this.notifyMe=this.item.querySelector(".productView-notifyMe"),this.hotStock=this.item.querySelector(".productView-hotStock");var u=document.getElementById("product-quick-view-form-"+this.dataset.product)?.querySelector('[name="add"]'),t=document.querySelectorAll(`#product-quick-view-form-${this.dataset.product}, #product-quick-view-form-installment-`+this.dataset.product),c=parseInt(this.quantityInput?.value);window.inventory_text.max;if(o){var o=window.variantStrings.unavailable;this.quantityInput?.setAttribute("disabled",!0),this.notifyMe&&(this.notifyMe.style.display="none"),this.hotStock&&(this.hotStock.style.display="none"),u.setAttribute("disabled",!0),u.textContent=o,this.quantityInput?.closest("quantity-quick-view-input").classList.add("disabled")}else{if(s){var o=window.variantStrings.soldOut;this.quantityInput?.setAttribute("data-price",this.currentVariant?.price),this.quantityInput?.setAttribute("disabled",!0),u.setAttribute("disabled",!0),u.textContent=o,this.quantityInput?.closest("quantity-quick-view-input").classList.add("disabled"),this.inventoryProp&&(this.inventoryProp.querySelector(".productView-info-value").textContent=window.inventory_text.outOfStock),this.notifyMe&&(this.notifyMe.querySelector('input[name="halo-notify-product-variant"]').value=this.currentVariant.title,this.notifyMe.querySelector(".notifyMe-text").innerHTML="",this.notifyMe.style.display="block"),this.hotStock&&(this.hotStock.style.display="none")}else{let t,e=this.currentVariant?.inventory_management,i,n,a,r;null!=e&&(i="quick_view_inven_array_"+this.dataset.product,null!=(n=window[i]))&&(a=n[this.currentVariant.id],void 0===(r=parseInt(a))||0<r?this.quantityInput?.setAttribute("data-inventory-quantity",r):this.quantityInput?.removeAttribute("data-inventory-quantity")),t=void 0===r||0<r?window.variantStrings.addToCart:window.variantStrings.preOrder,this.quantityInput?.setAttribute("data-price",this.currentVariant?.price),this.quantityInput?.removeAttribute("disabled"),u.innerHTML=t,u.removeAttribute("disabled"),this.quantityInput?.removeAttribute("disabled"),this.quantityInput?.closest("quantity-quick-view-input").classList.remove("disabled"),window.quick_view_subtotal.show&&(s=0,s=c*this.quantityInput?.dataset.price,s=Shopify.formatMoney(s,window.money_format),s=extractContent(s),(o=document.createElement("span")).classList.add(window.currencyFormatted?"money":"money-subtotal"),o.innerText=s,document.body.appendChild(o),this.checkNeedToConvertCurrency()&&(c=document.getElementById("currencies")?.querySelector(".active")?.getAttribute("data-currency"),Currency.convertAll(window.shop_currency,c,"span.money","money_format")),s=o.innerText,$(o).remove(),(document.querySelector(".quickView .productView-subtotal .money")||document.querySelector(".quickView .productView-subtotal .money-subtotal")).innerText=s),0<r?(u.classList.remove("button-text-pre-order"),parseInt(this.quantityInput?.getAttribute("data-inventory-quantity")),null!=this.inventoryProp&&(0<r?(c=this.inventoryProp.getAttribute("data-stock-level"),this.item.querySelector("[data-inventory] .productView-info-value").textContent="show"==c?r+" "+window.inventory_text.inStock:window.inventory_text.inStock):this.item.querySelector("[data-inventory] .productView-info-value").textContent=window.inventory_text.outOfStock),this.hotStock&&(o=parseInt(this.hotStock.getAttribute("data-hot-stock")),0<r&&r<=o?(s=window.inventory_text.hotStock.replace("[inventory]",r),this.hotStock.innerHTML=s,this.hotStock.style.display="block"):(this.hotStock.innerHTML="",this.hotStock.style.display="none"))):(u.removeAttribute("disabled"),u.classList.add("button-text-pre-order"),this.inventoryProp&&(this.inventoryProp.querySelector(".productView-info-value").textContent=window.inventory_text.inStock),this.hotStock&&(this.hotStock.style.display="none")),this.notifyMe&&(this.notifyMe.style.display="none"),this.checkNeedToConvertCurrency()&&(c=document.getElementById("currencies")?.querySelector(".active")?.getAttribute("data-currency"),Currency.convertAll(window.shop_currency,c,"span.money","money_format"))}this.skuProp&&this.currentVariant.sku&&(this.skuProp.querySelector(".productView-info-value").textContent=this.currentVariant.sku),t.forEach(t=>{t=t.querySelector('input[name="id"]');t.value=this.currentVariant.id,t.dispatchEvent(new Event("change",{bubbles:!0}))})}}getVariantData(){return this.variantData=this.variantData||JSON.parse(this.getAttribute("data-json")),this.variantData}checkNeedToConvertCurrency(){return window.show_multiple_currencies&&Currency.currentCurrency!=shopCurrency||window.show_auto_currency}checkQuantityWhenVariantChange(){var t=this.closest(".productView-details").querySelector("input.quantity__input"),e=parseInt(t?.dataset.inventoryQuantity),i=parseInt(t?.value);let n=i;((n=e<i&&0<e?e:i)<1||isNaN(n))&&(n=1),null!=t&&(t.value=n),document.getElementById("product-add-to-cart").dataset.available=this.currentVariant.available&&e<=0}}customElements.define("variant-quick-view-selects",VariantQuickViewSelects);class VariantQuickViewRadios extends VariantQuickViewSelects{constructor(){super()}updateOptions(){var t=Array.from(this.querySelectorAll("fieldset"));this.options=t.map(t=>Array.from(t.querySelectorAll("input")).find(t=>t.checked).value)}}customElements.define("variant-quick-view-radios",VariantQuickViewRadios);class QuantityQuickViewInput extends HTMLElement{constructor(){super(),this.input=this.querySelector("input"),this.changeEvent=new Event("change",{bubbles:!0}),this.input.addEventListener("change",this.onInputChange.bind(this)),this.querySelectorAll("button").forEach(t=>t.addEventListener("click",this.onButtonClick.bind(this)))}onInputChange(t){t.preventDefault();var e,i=this.input.value,t=parseInt(this.input.dataset.inventoryQuantity),n=document.getElementById("product-quick-view-form-"+this.input.dataset.product)?.querySelector('[name="id"]')?.value,a="true"===document.getElementById("product-add-to-cart").dataset.available||!1;document.getElementById("product-quick-view-form-"+this.input.dataset.product)?.querySelector('[name="add"]');i<1&&(i=1,this.input.value=i),t<i&&!a&&0<t?(e="quick_view_selling_array_"+this.input.dataset.product,"deny"==window[e][n]&&(i=t,this.input.value=i,showWarning(getInputMessage(t),3e3))):t<i&&a&&0===t&&(this.input.value=i),this.input.value=i,document.querySelectorAll('quantity-quick-view-input input[name="quantity"]').forEach(t=>{this.input!=t&&(t.value=i)}),document.querySelector(".quantity__group--1 .quantity__input").value=i,window.quick_view_subtotal.show&&(e=this.input.dataset.price,n=0,new DOMParser,n=i*e,n=Shopify.formatMoney(n,window.money_format),n=extractContent(n),(a=document.createElement("span")).classList.add(window.currencyFormatted?"money":"money-subtotal"),a.innerText=n,document.body.appendChild(a),this.checkNeedToConvertCurrency()&&(t=document.getElementById("currencies")?.querySelector(".active")?.getAttribute("data-currency"),Currency.convertAll(window.shop_currency,t,"span.money","money_format")),n=a.innerText,$(a).remove(),(document.querySelector(".quickView .productView-subtotal .money")||document.querySelector(".quickView .productView-subtotal .money-subtotal")).innerText=n)}onButtonClick(t){t.preventDefault();var e=this.input.value;"plus"===t.target.name?this.input.stepUp():this.input.stepDown(),e!==this.input.value&&this.input.dispatchEvent(this.changeEvent)}checkNeedToConvertCurrency(){return window.show_multiple_currencies&&Currency.currentCurrency!=shopCurrency||window.show_auto_currency}}function showWarning(t,e=null){window.warningTimeout&&clearTimeout(window.warningTimeout),document.getElementById("halo-warning-popup").querySelector("[data-halo-warning-content]").textContent=t,document.body.classList.add("has-warning"),e&&(window.warningTimeout=setTimeout(()=>{document.body.classList.remove("has-warning")},e))}function getInputMessage(t){return window.cartStrings.addProductOutQuantity.replace("[maxQuantity]",t)}customElements.define("quantity-quick-view-input",QuantityQuickViewInput);