class CartItems extends HTMLElement{constructor(){super(),this.cartCountDown=document.getElementById("CartCountdown-"+this.dataset.section),this.giftCardElement=document.getElementById("is-a-gift"),this.giftCardButton=document.getElementById("cart-gift-wrapping"),this.removeButtons=document.querySelectorAll("[data-cart-remove]"),this.toCheckoutButton=document.getElementById("cart-checkout"),this.couponCodeInput=document.getElementById("cart-coupon-code"),this.cartNoteInput=document.getElementById("cart-note"),this.checkTerms=document.getElementById("cart_conditions"),this.toCheckoutButton?.addEventListener("click",this.handleToCheckoutPage.bind(this)),this.initToCheckoutButtonDisabling(),this.initCartCountdown(),this.giftCardElement&&this.initGiftCardElement(),this.initGiftCardManipulation()}initGiftCardElement(){var t,e;"true"===this.giftCardButton?.dataset.isChecked?(e=this.giftCardButton?.dataset.giftId,t=document.querySelector(`[data-cart-remove-id="${e}"]`),e=document.querySelector(`[data-cart-quantity-id="${e}"]`),this.giftCardElement.style.display="none",t?.addEventListener("click",()=>{this.giftCardButton.dataset.isChecked="false"}),e?.addEventListener("change",t=>{Number(t.target.value)<=0&&(this.giftCardButton.dataset.isChecked="false")})):this.giftCardElement.style.display="flex"}initGiftCardManipulation(){this.giftCardButton&&(this.giftCardButton.removeEventListener("click",this.onAddGiftCardClick.bind(this)),this.giftCardButton.addEventListener("click",this.onAddGiftCardClick.bind(this)))}onAddGiftCardClick(t){t.preventDefault(),t.stopPropagation(),this.giftCardButton.dataset.isChecked="true"}initToCheckoutButtonDisabling(){this.checkTerms&&window.addEventListener("load",()=>{this.toCheckoutButton.disabled=!this.checkTerms.checked})}async handleToCheckoutPage(t){t.preventDefault();try{var e,i=this.couponCodeInput?.value,n=(i&&(localStorage.setItem("storedDiscount",i),await(await fetch("/discount/"+i)).text()),this.cartNoteInput?.value);n&&(e=JSON.stringify({note:n}),await(await fetch(""+routes.cart_update_url,{...fetchConfig(),body:e})).text())}catch(t){console.error("Error: "+t.message)}let a=this.toCheckoutButton.dataset.href;null==a&&(a=`${window.routes?.root?window.routes.root:""}/checkout`),window.location=a}initCartCountdown(){var t,e;this.cartCountDown&&!this.cartCountDown.classList.contains("is-running")&&(t=60*this.cartCountDown.getAttribute("data-cart-countdown"),e=this.cartCountDown.querySelector(".time"),this.cartCountDown.classList.add("is-running"),this.startTimerCartCountdown(t,e))}startTimerCartCountdown(t,e){var i,n,a=t,o=setInterval(()=>{n=parseInt(a/60,10),i=parseInt(a%60,10),n=(n<10?"0"+n:n)+":"+(i<10?"0"+i:i),e.innerText=n,--a<0&&(clearInterval(o),this.cartCountDown.remove())},1e3)}}customElements.define("cart-items",CartItems);