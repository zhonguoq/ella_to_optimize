class CollectionFiltersForm extends HTMLElement{constructor(){super(),this.filterData=[],this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.sidebarBlocks=this.querySelectorAll(".collection-filters__item [data-type-list]");var e=this.dataset.filterDisplay;this.debouncedOnSubmit=debounce(e=>{this.onSubmitHandler(e)},500),this.debouncedOnClick=debounce(e=>{this.onClickHandler(e)},500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this)),this.querySelector("#filter__price--apply")&&this.querySelector("#filter__price--apply").addEventListener("click",this.debouncedOnClick.bind(this)),0<$('.facets-horizontal .js-filter[style="display: none;"]').length?$(".results-count .results").hide():$(".results-count .results").show(),"show-more"===e&&CollectionFiltersForm.initListShowMore(this.sidebarBlocks),sessionStorage.setItem("filterDisplayType",e),sessionStorage.setItem("productGridId",JSON.stringify(document.getElementById("main-collection-product-grid").dataset.id))}static initListShowMore(l){let c=[];l.forEach((e,t)=>{var r,i=e.querySelector(".facets__list"),s=i.querySelectorAll(".list-menu__item");const o=parseInt(i.dataset.maxItems);let a=i.clientHeight;0===a&&((r=i.closest(".sidebarBlock-contentWrapper")).style.display="block",a=i.clientHeight,r.style.display="none"),i.style.maxHeight=a+"px",i.dataset.collapsedHeight=a,s.forEach((e,t)=>{e.classList.remove("d-none"),t+1>o&&(e.style.opacity="0")}),c.push({index:e.dataset.index,collapsedHeight:a,extendedHeight:0,showingMore:!1}),t===l.length-1&&sessionStorage.setItem("heightData",JSON.stringify(c))});var e=document.querySelectorAll(".show-more--list_tags");e&&e.forEach(e=>e.addEventListener("click",CollectionFiltersForm.toggleShowMore))}static toggleShowMore(e){var t=JSON.parse(sessionStorage.getItem("heightData"))||[],r=e.target.closest("[data-show-more-btn]").querySelector("[data-show-more-content]");const i=e.target.closest(".sidebarBlock");var e=i.querySelector(".facets__list"),s=e.querySelectorAll(".facets__list .list-menu__item"),o=t.find(e=>e.index===i.dataset.index),a=parseInt(e.dataset.collapsedHeight)||o.collapsedHeight;const l=parseInt(e.dataset.maxItems);let c;l<=10&&(c=3*a),(c=10<l&&l<=20?2*a:c)>window.innerHeight&&(c=+a),i.classList.contains("show-more")?(i.classList.remove("show-more"),r.textContent=window.show_more_btn_text.show_all,e.scrollTo({top:0,behavior:"smooth"}),e.style.maxHeight=a+"px",s.forEach((e,t)=>{t+1>l&&(e.style.opacity="0")}),o.showingMore=!1):(i.classList.add("show-more"),e.style.maxHeight=c+"px",r.textContent=window.show_more_btn_text.show_less,s.forEach(e=>{e.style.opacity="1"}),o.showingMore=!0),o.extendedHeight=c,sessionStorage.setItem("heightData",JSON.stringify(t))}static renderRemainingFilters(e){let l=JSON.parse(sessionStorage.getItem("heightData"))||[];e.forEach(t=>{var e=document.querySelector(`.js-filter[data-index="${t.dataset.index}"]`),r=(e.innerHTML=t.innerHTML,l.find(e=>e.index===t.dataset.index)),i=e.querySelector(".facets__list"),s=i.querySelectorAll(".list-menu__item.d-none"),o=e.querySelector("[data-show-more-btn]"),a=o?.querySelector("[data-show-more-content]");s.forEach(e=>e.classList.remove("d-none")),o?.addEventListener("click",CollectionFiltersForm.toggleShowMore),i.dataset.collapsedHeight=r.collapsedHeight,null!=a&&(r.showingMore?(i.style.maxHeight=r.extendedHeight+"px",e.classList.add("show-more"),a.textContent=window.show_more_btn_text.show_less):(i.style.maxHeight=r.collapsedHeight+"px",e.classList.remove("show-more"),a.textContent=window.show_more_btn_text.show_all))})}static renderPriceFilter(e){var t;e&&((t=document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`)).innerHTML=e.innerHTML,e=debounce(e=>{CollectionFiltersForm.handleClick(e)},500),t.querySelector("#filter__price--apply"))&&t.querySelector("#filter__price--apply").addEventListener("click",e)}static setListeners(){window.addEventListener("popstate",e=>{e=e.state?e.state.searchParams:CollectionFiltersForm.searchParamsInitial;e!==CollectionFiltersForm.searchParamsPrev&&CollectionFiltersForm.renderPage(e,null,!1)})}static toggleActiveFacets(t=!0){document.querySelectorAll(".js-facet-remove").forEach(e=>{e.classList.toggle("disabled",t)})}static resizeGridItem(e){grid=document.getElementsByClassName("halo-row--masonry")[0],rowHeight=parseInt(window.getComputedStyle(grid).getPropertyValue("grid-auto-rows")),rowGap=parseInt(window.getComputedStyle(grid).getPropertyValue("grid-row-gap")),rowSpan=Math.ceil((e.querySelector(".collection-masonry .product-masonry-item .product-item").getBoundingClientRect().height+rowGap)/(rowHeight+rowGap)),e.style.gridRowEnd="span "+rowSpan}static resizeAllGridItems(){for(allItems=document.getElementsByClassName("product-masonry-item"),x=0;x<allItems.length;x++)this.resizeGridItem(allItems[x])}static renderPage(i,s,e=!0){CollectionFiltersForm.searchParamsPrev=i;var t=CollectionFiltersForm.getSections();document.body.classList.add("has-halo-loader"),t.forEach(e=>{const t=`${window.location.pathname}?section_id=${e.section}&`+i;var r=e=>e.url===t;CollectionFiltersForm.filterData.some(r)?CollectionFiltersForm.renderSectionFromCache(r,e,s):CollectionFiltersForm.renderSectionFromFetch(t,e,s)}),e&&CollectionFiltersForm.updateURLHash(i)}static renderSectionFromFetch(t,e,r){fetch(t).then(e=>e.text()).then(e=>{CollectionFiltersForm.filterData=[...CollectionFiltersForm.filterData,{html:e,url:t}],CollectionFiltersForm.renderFilters(e,r),CollectionFiltersForm.renderProductGrid(e)})}static renderSectionFromCache(e,t,r){e=this.filterData.find(e).html;this.renderFilters(e,r),this.renderProductGrid(e)}static setProductForWishlist(e){var t=JSON.parse(localStorage.getItem("wishlistItem")),r=$('[data-wishlist-handle="'+e+'"]');0<=t.indexOf(e)?r.addClass("wishlist-added").find(".text").text(window.wishlist.added):r.removeClass("wishlist-added").find(".text").text(window.wishlist.add)}static setLocalStorageProductForWishlist(){var e=localStorage.getItem("wishlistItem")?JSON.parse(localStorage.getItem("wishlistItem")):[];localStorage.setItem("wishlistItem",JSON.stringify(e)),0<e.length&&(e=JSON.parse(localStorage.getItem("wishlistItem"))).forEach(e=>{this.setProductForWishlist(e)}),$("[data-wishlist-count]").text(e.length)}static setLocalStorageProductForCompare(e){var i=JSON.parse(localStorage.getItem("compareItem")),t=$("[data-product-compare-handle]");null!==i&&0<t.length&&t.each((e,t)=>{var t=$(t),r=t.data("product-compare-handle");0<=i.indexOf(r)?(t.find(".compare-icon").addClass("is-checked"),t.find(".text").text(window.compare.added),t.find("input").prop("checked",!0)):(t.find(".compare-icon").removeClass("is-checked"),t.find(".text").text(window.compare.add),t.find("input").prop("checked",!1))})}static renderProductGrid(e){var t=(new DOMParser).parseFromString(e,"text/html").getElementById("CollectionProductGrid").querySelector(".collection")?.innerHTML,t=(document.getElementById("CollectionProductGrid").querySelector(".collection").innerHTML=t,(new DOMParser).parseFromString(e,"text/html").getElementById("CollectionProductGrid").querySelector(".results-count .count")?.innerHTML);0<$('.facets-horizontal .js-filter[style="display: none;"]').length?$(".results-count .results").hide():($(".results-count .results").show(),$(".results-count .count").text(t)),0<$(".toolbar").length&&this.setActiveViewModeMediaQuery(!0),window.compare.show&&this.setLocalStorageProductForCompare({link:$("a[data-compare-link]"),onComplete:null}),window.wishlist.show&&this.setLocalStorageProductForWishlist(),window.innerWidth<1025&&window.scrollTo({top:document.getElementById("CollectionProductGrid").getBoundingClientRect().top+window.pageYOffset-50,behavior:"smooth"}),document.body.classList.remove("has-halo-loader"),document.querySelector(".collection-masonry")&&(document.getElementById("CollectionProductGrid").querySelector(".collection .halo-row--masonry").classList.add("is-show"),CollectionFiltersForm.resizeAllGridItems())}static renderFilters(e,t){var e=(new DOMParser).parseFromString(e,"text/html"),r=e.querySelectorAll("#CollectionFiltersForm .js-filter");const i=t?.target.closest(".js-filter")?.dataset.index,s=e=>e.dataset.index===i;var o=Array.from(r).filter(e=>!s(e)),a=Array.from(r).find(s);o.forEach(e=>{document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`).innerHTML=e.innerHTML}),document.querySelector(`.facets__reset[data-index="${i}"]`)&&(document.querySelector(`.facets__reset[data-index="${i}"]`).style.display="block"),CollectionFiltersForm.renderActiveFacets(e),a&&CollectionFiltersForm.renderCounts(a,t.target.closest(".js-filter")),"show-more"===sessionStorage.getItem("filterDisplayType")&&(o=Array.from(r).filter(e=>e.dataset.typeList&&e.dataset.index!==i),CollectionFiltersForm.renderRemainingFilters(o)),CollectionFiltersForm.renderPriceFilter(Array.from(r).find(e=>e.dataset.typePrice&&e.dataset.index!==i))}static handleClick(e){e.preventDefault();var t=e.target.closest("form"),r=t.querySelectorAll('input[type="number"]'),i=r[0],r=r[1],i=(r.value&&i.setAttribute("max",r.value),i.value&&r.setAttribute("min",i.value),""===i.value&&(r.setAttribute("min",0),i.value=Number(i.getAttribute("min"))),""===r.value&&(i.setAttribute("max",r.getAttribute("max")),r.value=Number(r.getAttribute("max"))),new FormData(t)),r=new URLSearchParams(i).toString();CollectionFiltersForm.renderPage(r,e)}static renderActiveFacets(r){[".refined-widgets"].forEach(e=>{var t=r.querySelector(e);t&&(document.querySelector(e),t.innerHTML,document.querySelector(e).querySelector("li")?document.querySelector(e).style.display="block":document.querySelector(e).style.display="none")}),CollectionFiltersForm.toggleActiveFacets(!1),setTimeout(()=>{r.querySelectorAll(".collection-filters__item [data-type-list]")},500)}static renderCounts(r,i){[".facets__count"].forEach(e=>{var t=i.querySelector(e);r.querySelector(e)&&t&&(i.querySelector(e).outerHTML=r.querySelector(e).outerHTML)})}static updateURLHash(e){history.pushState({searchParams:e},"",""+window.location.pathname+(e&&"?".concat(e)))}static getSections(){return[{id:"main-collection-product-grid",section:document.getElementById("main-collection-product-grid")?.dataset.id||JSON.parse(sessionStorage.getItem("productGridId"))}]}static setActiveViewModeMediaQuery(e=!0){var t=document.querySelector("[data-view-as]"),r=document.querySelector("[data-view-as-mobile]"),i=t?.querySelector(".icon-mode.active"),s=r?.querySelector(".icon-mode.active"),o=parseInt(i?.dataset.col),a=window.innerWidth;t&&r&&(1!=o?(document.querySelector(".sidebar--layout_vertical")?a<768?3!=o&&4!=o&&5!=o||(o=2,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-2").classList.add("active"),r.querySelector(".grid-2").classList.add("active")):a<=1100&&768<=a?5!=o&&4!=o&&3!=o||(o=2,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-2").classList.add("active"),r.querySelector(".grid-2").classList.add("active")):a<1599&&1100<a?5!=o&&4!=o||(o=3,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-3").classList.add("active"),r.querySelector(".grid-3").classList.add("active")):a<1700&&1599<=a&&5==o&&(o=4,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-4").classList.add("active"),r.querySelector(".grid-4").classList.add("active")):a<768?3!=o&&4!=o&&5!=o||(o=2,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-2").classList.add("active"),r.querySelector(".grid-2").classList.add("active")):a<992&&768<=a?4!=o&&5!=o||(o=3,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-3").classList.add("active"),r.querySelector(".grid-3").classList.add("active")):a<1600&&992<=a&&5==o&&(o=4,i.classList.remove("active"),s.classList.remove("active"),t.querySelector(".grid-4").classList.add("active"),r.querySelector(".grid-4").classList.add("active")),this.initViewModeLayout(o)):e&&this.initViewModeLayout(o))}static initViewModeLayout(e){var t=document.getElementById("CollectionProductGrid").querySelector(".productListing");if(t)if(1===e)t.classList.remove("productGrid","column-5","column-4","column-3","column-2"),t.classList.add("productList");else switch(e){case 2:t.classList.remove("productList","column-5","column-4","column-3"),t.classList.add("productGrid","column-2");break;case 3:t.classList.remove("productList","column-5","column-4","column-2"),t.classList.add("productGrid","column-3");break;case 4:t.classList.remove("productList","column-5","column-3","column-2"),t.classList.add("productGrid","column-4");break;case 5:t.classList.remove("productList","column-4","column-3","column-2"),t.classList.add("productGrid","column-5")}}onClickHandler(e){e.preventDefault();var t=e.target.closest("form"),r=t.querySelectorAll('input[type="number"]'),i=r[0],r=r[1],i=(r.value&&i.setAttribute("max",r.value),i.value&&r.setAttribute("min",i.value),""===i.value&&(r.setAttribute("min",0),i.value=Number(i.getAttribute("min"))),""===r.value&&(i.setAttribute("max",r.getAttribute("max")),r.value=Number(r.getAttribute("max"))),new FormData(t)),r=new URLSearchParams(i).toString();CollectionFiltersForm.renderPage(r,e)}onSubmitHandler(e){var t;e.preventDefault(),e.target.classList.contains("filter__price")||(t=new FormData(e.target.closest("form")),t=new URLSearchParams(t).toString(),CollectionFiltersForm.renderPage(t,e))}onSubmitHandlerFromSortBy(e,t){e.preventDefault(),e.target.classList.contains("filter__price")||(t=new FormData(t),t=new URLSearchParams(t).toString(),CollectionFiltersForm.renderPage(t,e))}onActiveFilterClick(e){e.preventDefault(),CollectionFiltersForm.toggleActiveFacets();e=-1==e.currentTarget.href.indexOf("?")?"":e.currentTarget.href.slice(e.currentTarget.href.indexOf("?")+1);CollectionFiltersForm.renderPage(e)}}CollectionFiltersForm.filterData=[],CollectionFiltersForm.searchParamsInitial=window.location.search.slice(1),CollectionFiltersForm.searchParamsPrev=window.location.search.slice(1),customElements.define("collection-filters-form",CollectionFiltersForm),CollectionFiltersForm.setListeners();class PriceRange extends HTMLElement{constructor(){super(),this.rangeSliderPrice(),this.querySelectorAll("input").forEach(e=>{e.addEventListener("change",this.onRangeChange.bind(this))}),this.setMinAndMaxValues();var e=this.querySelectorAll("input[type=number]"),t=e[0].value,e=e[1].value;this.updateDisplay(t,e)}onRangeChange(e){this.adjustToValidValues(e.currentTarget),this.setMinAndMaxValues()}setMinAndMaxValues(){var e=this.querySelectorAll("input"),t=e[0],e=e[1];""===t.value&&e.setAttribute("min",0),""===e.value&&t.setAttribute("max",e.getAttribute("max"))}adjustToValidValues(e){var t=Number(e.value),r=Number(e.getAttribute("min")),i=Number(e.getAttribute("max"));t<r&&(e.value=r),i<t&&(e.value=i)}rangeSliderPrice(){var s=this.querySelectorAll("input[type=range]"),o=this.querySelectorAll("input[type=number]");s.forEach(e=>{e.oninput=()=>{var e=parseFloat(s[0].value),t=parseFloat(s[1].value);t<e&&([e,t]=[t,e]),o[0].value=e,o[1].value=t,this.updateDisplay(o[0].value,o[1].value)}}),o.forEach(e=>{e.oninput=()=>{var e=parseFloat(o[0].value),t=e!=e,r=parseFloat(o[1].value),i=r!=r;t||(s[0].value=e),i||(s[1].value=r),r<e?this.updateDisplay(r,e):this.updateDisplay(e,r)}})}updateDisplay(e,t){var r=this.querySelector("input[type=range]"),i=this.querySelector(".facets__price--slide"),r=r.max,s=i.clientWidth,e=parseInt(e)/parseInt(r)*s+"px",t=s-parseInt(t)/parseInt(r)*s+"px";i.style.setProperty("--left-space",e),i.style.setProperty("--right-space",t)}}customElements.define("price-range",PriceRange);class FacetRemove extends HTMLElement{constructor(){super(),this.querySelector("a").addEventListener("click",e=>{e.preventDefault(),(this.closest("collection-filters-form")||document.querySelector("collection-filters-form")).onActiveFilterClick(e)})}}customElements.define("facet-remove",FacetRemove);